<div class="ui grid">
    <div class="row">
        <div class="ui breadcrumb">
            <div class="active section breadcrumb-header">Studien-Manager</div>
        </div>
    </div>

    <form ngNativeValidate class="ui form sixteen wide column">
        <div class="ui row studies">
            <div class="field">
                <label>Studie</label>
                <select class="ui dropdown" name="studies" [(ngModel)]="filterdata.study" (change)="setEntries(filterActive).subscribe()">
                    <option *ngFor="let option of studies" [ngValue]="option.id">
                            {{ option.title }}
                    </option>
                </select>
            </div>
        </div>
        <div class="ui segment row filter">
            <div class="seven fields">
                <div class="one wide field"></div>
                <div class="five wide field">
                        <label>Teilnahme</label>
                        <div class="three inline fields">
                            <div class="ui checkbox">
                                <input type="checkbox" name="optIn" [(ngModel)]="filterdata.optIn">
                                <label>Einschluss</label>
                            </div>
                            <div class="one wide field"></div>
                            <div class="ui checkbox">
                                <input type="checkbox" name="optOut"  [(ngModel)]="filterdata.optOut">
                                <label>Ausschluss</label>
                            </div>
                        </div>
                </div>
                <div class="one wide field"></div>
                <div class="five wide field">
                    <label>Datum</label>
                    <my-date-picker style="width: 100%" class="ui input" name="DPStudyManager" [options]="DPOptions" [(ngModel)]="filterdata.date"></my-date-picker>
                </div>
                <div class="one wide field"></div>
                <div class="ui small labeled left floated icon button" (click)="setEntries(true).subscribe()">
                    <i class="filter icon"></i> Filtern
                </div>
            </div>
        </div>

    </form>
    <!-- TODO: AuditTrail -->
</div>
<div class="ui segments container">
    <div class="ui segment ui grid buttonbar">
        <div class="ui sixteen wide column">
            <div class="ui small labeled left floated icon button" (click)="resetFilter()" [ngClass]="filterActive ? '' : 'disabledButton'" >
                <i class="close icon"></i> Filter zurücksetzen
            </div>
            <div *ngIf="isAuthorized('WRITE_STUDYMANAGER')" class="ui small labeled right floated icon button newButton" (click)="createEntry()">
                <i class="plus icon"></i> Eintrag erstellen
            </div>
        </div>
    </div>
    <table class="ui sortable selectable celled table ui segment">
        <thead>
            <tr>
                <th class="tsorted ascending" width="18%">Studie</th>
                <th class="sorted ascending" width="18%">SIC</th>
                <th id="default-sort" class="sorted ascending" width="20%">Datum</th>
                <th class="sorted ascending" width="15%">Teilnahme</th>
                <th class="sorted ascending" width="29%">Kommentar</th>
            </tr>
        </thead>
        <tbody>
        <tr *ngFor="let entry of filteredEntries | paginate: { itemsPerPage: 15, currentPage: p }" (click)="showEntry(entry)">
            <td width="18%">
                {{ entry.study.title }}
            </td>

            <td width="18%">
                {{ entry.sic }}
            </td>

            <td width="20%">
                {{ entry.timestamp | date: 'dd.MM.yyyy, HH:mm' }}
            </td>

            <td width="15%">
                {{ entry.participationString }}
            </td>

            <td title="{{entry.comment}}" class="truncated" width="29%">
                {{ entry.comment }}
            </td>
        </tr>
        </tbody>
        <tfoot>
            <th colspan="5">
                <pagination-controls class="pagination"
                    (pageChange)="p = $event"
                    autoHide="true"
                    previousLabel="Vorherige Seite"
                    nextLabel="Nächste Seite">
                </pagination-controls>
            </th>
        </tfoot>
    </table>
</div>

<popup-newEntry [studies]="studies" [selectedStudy]="filterdata.study"></popup-newEntry>
<popup-detail [entry]="selectedEntry"></popup-detail>
<popup-message></popup-message>
