WEBCLIENT - I2B2 API Definition
===============================

|-----------------------------------------------------------------------------------------------------------------|
|           Client Browser            |            ADMIN Backend            |            I2B2 PM Cell             |
|-------------------------------------|-------------------------------------|-------------------------------------|
| JS, HTML                            | Java                                |                                     |
| AngularJS, Semantic UI              |                                     |                                     |
|                                   JSON                                XML (/JSON?)                              |
|------------------~------------------~------------------~------------------~------------------~------------------|
{
    command : "string"
    data : "data object"

    // in response:
    code : "xml / html code response from i2b2"
    requestdata : "data object sent with request, maybe obscured e.g. password"
}
-user
-logs
-preferences
|------------------~------------------~------------------~------------------~------------------~------------------|
| USER                                                                                                            |
|------------------~------------------~------------------~------------------~------------------~------------------|
-user
    -auth
    -list
    -create
    -edit
|------------------|------------------~------------------|------------------~------------------|------------------|
| AUTH:            |    LOGIN (username + PW)            |             LOGIN (username + PW)   |                  |
|                  | ----------------------------------> | ----------------------------------> | AUTH i2b2        |
|                  | <---------------------------------- | <---------------------------------- |                  |
|                  |    Sessionkey S_2        Generate S_2 from S_1   Roles, Sessionkey S_1    |                  |
|                  |                          save Roles of User                               |                  |
|------------------|------------------~------------------|------------------~------------------|------------------|
Request: 
{
    command : "user auth",
    data : {
        username : "i2b2",
        password : "demouser",
    }
}
Response:
{ // success
    command : "user auth",
    code : "200", // success
    requestdata : {
        username : "i2b2",
        password : null,
    },
    data : {
        sessionkey : "llaisjdiqwji1u2399",
    }
}
{ // failed
    command : "user auth",
    code : "30?", // restricted
    requestdata : {
        username : "i2b2",
        password : null,
    },
    data : {
        reason : "some reason, e.g. wrong password",
    }
}
|------------------|------------------~------------------|------------------~------------------|------------------|
| LIST USERS       |    LIST USERS, S_2            retrieve S_1             LIST USERS, S_1    |                  |
|                  | ----------------------------------> | ----------------------------------> | Check S_1, Roles |
|                  | <---------------------------------- | <---------------------------------- |  Query List      |
|                  |    Users List                 Transform List                Users List    |                  |
|------------------|------------------~------------------|------------------~------------------|------------------|
Request: 
{
    command : "user list",
    data : {
        username : "i2b2",
        sessionkey : "llaisjdiqwji1u2399",
        filter : null,
    }
}
Response:
{ // success
    command : "user list",
    code : "200", // success
    requestdata : {
        username : "i2b2",
        sessionkey : "llaisjdiqwji1u2399",
    },
    data : {
        users : [
            {
                user obj...
            }
        ],
    }
}
{ // failed
    command : "user list",
    code : "30?", // restricted
    requestdata : {
        username : "i2b2",
        sessionkey : "llaisjdiqwji1u2399",
    },
    data : {
        reason : "some reason, e.g. no right",
    }
}
|------------------|------------------~------------------|------------------~------------------|------------------|
| CREATE USER      |    CREATE USER, S_2           retrieve S_1            CREATE USER, S_1    |                  |
|                  | ----------------------------------> | ----------------------------------> | Check S_1, Roles |
|                  | <---------------------------------- | <---------------------------------- |  CREATE USER     |
|                  |    RESULT (+Users List)      Transform Answer     RESULT (+Users List)    |                  |
|------------------|------------------~------------------|------------------~------------------|------------------|
| EDIT USER        |    EDIT USER, S_2             retrieve S_1              EDIT USER, S_1    |                  |
|                  | ----------------------------------> | ----------------------------------> | Check S_1, Roles |
|                  | <---------------------------------- | <---------------------------------- |  EDIT USER       |
|                  |    RESULT                    Transform Answer                   RESULT    |                  |
|------------------|------------------~------------------|------------------~------------------|------------------|


|------------------|------------------~------------------|------------------~------------------|------------------|
| AUTH Check       |    COMMAND, S_2       retrieve S_1, find ROLE needed   Check Role, S_1    |                  |
| ROLE Check       | ----------------------------------> | ----------------------------------> | Check S_1, Role  |
|                  | <---------------------------------- | <---------------------------------- |                  |
|                  |    RESULT            Perform COMMAND, if has ROLE               RESULT    |                  |
|------------------|------------------~------------------|------------------~------------------|------------------|

|------------------~------------------~------------------~------------------~------------------~------------------|
| LOGS          -- no i2b2 interaction, only auth and role check                                                  |
|------------------~------------------~------------------~------------------~------------------~------------------|
-logs
    -list
    -delete
|------------------~------------------~------------------~------------------~------------------~------------------|
| PREF          -- no i2b2 interaction, only auth and role check                                                  |
|------------------~------------------~------------------~------------------~------------------~------------------|
-preferences
    -list
    -edit
    -view